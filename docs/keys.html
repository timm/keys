<div class="highlight"><pre><span></span><span class="cp">#!/usr/bin/env lua</span>
<span class="c1">-- vim: filetype=lua ts=2 sw=2 sts=2 et :</span>
<span class="kd">local</span> <span class="n">help</span><span class="o">=</span><span class="s">[[</span>
<span class="s"> ,-_|\   Contrast set learning</span>
<span class="s">/     \  (c) Tim Menzies, 2021, unlicense.org</span>
<span class="s">\_,-._*  Cluster, then reports, just the </span>
<span class="s">     v   deltas between similar clusters.]]</span>

<span class="kd">local</span> <span class="n">b4</span><span class="o">=</span><span class="p">{};</span> <span class="kr">for</span> <span class="n">k</span><span class="p">,</span><span class="n">_</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">_ENV</span><span class="p">)</span> <span class="kr">do</span> <span class="n">b4</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">k</span> <span class="kr">end</span>
<span class="kd">local</span> <span class="n">argparse</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&quot;argparse&quot;</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">cli</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">sorted</span>
 
<span class="kr">function</span> <span class="nf">config</span><span class="p">()</span> <span class="kr">return</span>  <span class="p">{</span>
  <span class="n">bins</span><span class="o">=</span>    <span class="p">{</span><span class="mf">.5</span>     <span class="p">,</span><span class="s1">&#39;bins are of size n**BINS&#39;</span><span class="p">},</span>
  <span class="n">cols</span><span class="o">=</span>    <span class="p">{</span><span class="s1">&#39;x&#39;</span>    <span class="p">,</span><span class="s1">&#39;columns to use for inference&#39;</span><span class="p">},</span>
  <span class="n">data</span><span class="o">=</span>    <span class="p">{</span><span class="s1">&#39;../data/auto2.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;where to read data&#39;</span><span class="p">},</span>
  <span class="n">far</span><span class="o">=</span>     <span class="p">{</span><span class="mf">.9</span>     <span class="p">,</span><span class="s1">&#39;where to look for far things&#39;</span><span class="p">},</span>
  <span class="n">goaL</span><span class="o">=</span>    <span class="p">{</span><span class="s1">&#39;best&#39;</span> <span class="p">,</span><span class="s1">&#39;learning goals: best|rest|other&#39;</span><span class="p">},</span>
  <span class="n">iota</span><span class="o">=</span>    <span class="p">{</span><span class="mf">.3</span>     <span class="p">,</span><span class="s1">&#39;small = sd**iota&#39;</span><span class="p">},</span>
  <span class="n">k</span><span class="o">=</span>       <span class="p">{</span><span class="mi">2</span>      <span class="p">,</span><span class="s1">&#39;bayes low class frequency hack&#39;</span><span class="p">},</span>
  <span class="n">m</span><span class="o">=</span>       <span class="p">{</span><span class="mi">1</span>      <span class="p">,</span><span class="s1">&#39;bayes low range frequency hack&#39;</span><span class="p">},</span>
  <span class="n">p</span><span class="o">=</span>       <span class="p">{</span><span class="mi">2</span>      <span class="p">,</span><span class="s1">&#39;distance calculation exponent&#39;</span><span class="p">},</span>
  <span class="n">samples</span><span class="o">=</span> <span class="p">{</span><span class="mi">20</span>     <span class="p">,</span><span class="s1">&#39;#samples to find far things?&#39;</span><span class="p">},</span>
  <span class="n">seed</span><span class="o">=</span>    <span class="p">{</span><span class="mi">10013</span>  <span class="p">,</span> <span class="s1">&#39;seed for random numbers&#39;</span><span class="p">},</span>
  <span class="n">top</span><span class="o">=</span>     <span class="p">{</span><span class="mi">10</span>     <span class="p">,</span><span class="s1">&#39;focus on this many&#39;</span><span class="p">},</span>
  <span class="n">unsafe</span><span class="o">=</span>  <span class="p">{</span><span class="kc">false</span>  <span class="p">,</span><span class="s1">&#39;run example, no protection&#39;</span><span class="p">},</span>
  <span class="n">verbose</span><span class="o">=</span> <span class="p">{</span><span class="kc">false</span>  <span class="p">,</span><span class="s1">&#39;set verbose&#39;</span><span class="p">},</span>
  <span class="n">xample</span><span class="o">=</span>  <span class="p">{</span><span class="s2">&quot;&quot;</span>     <span class="p">,</span><span class="s2">&quot;&#39;-x ls&#39; lists all, &#39;-x all&#39; runs all&quot;</span><span class="p">}}</span>
<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">sorted</span><span class="p">(</span><span class="n">t</span><span class="p">,</span>         <span class="n">i</span><span class="p">,</span><span class="n">keys</span><span class="p">)</span>
  <span class="n">i</span><span class="p">,</span><span class="n">keys</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,{}</span>
  <span class="kr">for</span> <span class="n">k</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="kr">do</span> <span class="n">keys</span><span class="p">[</span><span class="o">#</span><span class="n">keys</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span> <span class="kr">end</span>
  <span class="nb">table.sort</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
  <span class="kr">return</span> <span class="kr">function</span> <span class="p">()</span>
    <span class="kr">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="o">#</span><span class="n">keys</span> <span class="kr">then</span>
      <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span> <span class="kr">return</span> <span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="kr">end</span> <span class="kr">end</span>
<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">cli</span><span class="p">(</span><span class="n">what</span><span class="p">,</span><span class="n">txt</span><span class="p">,</span><span class="n">t</span><span class="p">,</span>       <span class="n">arg</span><span class="p">)</span>
  <span class="n">arg</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">(</span><span class="n">what</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>
  <span class="kr">for</span> <span class="n">flag</span><span class="p">,</span><span class="n">v</span> <span class="kr">in</span> <span class="n">sorted</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="kr">do</span>
    <span class="kr">if</span>   <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="kc">false</span>
    <span class="kr">then</span> <span class="n">arg</span><span class="p">:</span><span class="n">flag</span><span class="p">(</span><span class="s2">&quot;--&quot;</span><span class="o">..</span><span class="n">flag</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="kr">else</span> <span class="kr">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">b4</span><span class="p">)</span><span class="o">==</span><span class="n">number</span> 
    <span class="kr">then</span> <span class="n">arg</span><span class="p">:</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;--&quot;</span><span class="o">..</span><span class="n">flag</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span><span class="n">convert</span><span class="p">{</span><span class="nb">tonumber</span><span class="p">}</span>
    <span class="kr">else</span> <span class="n">arg</span><span class="p">:</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;--&quot;</span><span class="o">..</span><span class="n">flag</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="kr">end</span> <span class="kr">end</span> <span class="kr">end</span>
  <span class="kr">return</span> <span class="n">arg</span><span class="p">:</span><span class="n">parse</span><span class="p">()</span> <span class="kr">end</span>

<span class="nb">print</span><span class="p">(</span><span class="n">cli</span><span class="p">(</span><span class="s2">&quot;./keys&quot;</span><span class="p">,</span> <span class="n">help</span><span class="p">,</span> <span class="n">config</span><span class="p">()).</span><span class="n">k</span><span class="p">)</span>
<span class="kr">for</span> <span class="n">k</span><span class="p">,</span><span class="n">_</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">_ENV</span><span class="p">)</span> <span class="kr">do</span> <span class="kr">if</span> <span class="ow">not</span> <span class="n">b4</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="kr">then</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;?? &quot;</span><span class="o">..</span><span class="n">k</span><span class="p">)</span> <span class="kr">end</span> <span class="kr">end</span>
</pre></div>
