<!DOCTYPE html>

<html>
<head>
  <title>class Sample</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-1">&#x00a7;</a>
              </div>
              <h1 id="class-sample">class Sample</h1>
<a href="http://menzies.us/keys"><img align=right width=150 src="duo101a.png"></a>
<a href="https://github.com/timm/keys"               class="github-corner" aria-label="View source on GitHub"><svg               width="80" height="80" viewBox="0 0 250 250" style="fill:#FD6C6C;               color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path               d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path               d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
<p style="text-align:left;">
    <b>Duo101. data miners using/used-by optimizers</b>
<br>&copy;2021 <a href="http://menzies.us">Tim Menzies</a>, timm@ieee.org
<br><br>Inference = cluster, discretize, contrast 
<br>
<br><b>about:</b> <a href="http://menzies.us/keys">home</a>, <a href="use.html">use</a>, <a href="install.html">install</a>, <a href="http://https://github.com/timm/keys/blob/main/LICENSE.md">license</a>, <a href="http://https://github.com/timm/keys/discussions">discuss</a>
<br><b>lib:</b> <a href="list.html">list</a>, <a href="maths.html">maths</a>, <a href="obj.html">obj</a>, <a href="rand.html">rand</a>, <a href="stats.html">stats</a>, <a href="strings.html">strings</a>
<br><b>cols:</b> <a href="num.html">num</a>, <a href="skip.html">skip</a>, <a href="some.html">some</a>, <a href="sym.html">sym</a>
<br><b>data:</b> <a href="numtools.html">numtools</a>, <a href="sample.html">sample</a>
<br><b>cli:</b> <a href="about.html">about</a>, <a href="cli.html">cli</a>
<br><b>tool:</b> <a href="nb.html">nb</a>
</p>
<img alt="Lua" src="https://img.shields.io/badge/lua-v5.4-blue"> 
<a href="https://github.com/timm/keys/blob/master/LICENSE.md"><img alt="License" src="https://img.shields.io/badge/license-unlicense-red"></a> 
<img src="https://img.shields.io/badge/purpose-ai%20,%20se-blueviolet"> 
<img alt="Platform" src="https://img.shields.io/badge/platform-osx%20,%20linux-lightgrey"> 
<a href="https://github.com/timm/keys/actions"><img src="https://github.com/timm/keys/actions/workflows/unit-test.yml/badge.svg"></a> 
<a href="https://zenodo.org/badge/latestdoi/318809834"><img src="https://zenodo.org/badge/318809834.svg"></a>
<hr>
<table>
<thead>
<tr>
<th><strong>Class</strong></th>
<th align="right">Sample</th>
<th>: category= data</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Does</strong></td>
<td align="right">1</td>
<td>: stores some rows</td>
</tr>
<tr>
<td></td>
<td align="right">2</td>
<td>: summarizes the rows in columns</td>
</tr>
<tr>
<td><strong>Has</strong></td>
<td align="right">cols</td>
<td>: all the columns</td>
</tr>
<tr>
<td></td>
<td align="right">keep</td>
<td>: if true then keep input row into rows</td>
</tr>
<tr>
<td></td>
<td align="right">klass</td>
<td>: the class column (if there is  one)</td>
</tr>
<tr>
<td></td>
<td align="right">rows</td>
<td>: list of rows</td>
</tr>
<tr>
<td></td>
<td align="right">x</td>
<td>: all the independent columns</td>
</tr>
<tr>
<td></td>
<td align="right">y</td>
<td>: all the dependent columns</td>
</tr>
<tr>
<td><strong>Uses</strong></td>
<td align="right"></td>
<td>: <a href="num.html">Num</a>, <a href="skip.html">Skip</a>, <a href="sym.html">Sym</a></td>
</tr>
</tbody></table>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> Sample={}
<span class="hljs-keyword">local</span> Num = <span class="hljs-built_in">require</span><span class="hljs-string">&quot;num&quot;</span>
<span class="hljs-keyword">local</span> Sym = <span class="hljs-built_in">require</span><span class="hljs-string">&quot;sym&quot;</span>
<span class="hljs-keyword">local</span> Skip= <span class="hljs-built_in">require</span><span class="hljs-string">&quot;skip&quot;</span>
<span class="hljs-keyword">local</span> obj = <span class="hljs-built_in">require</span><span class="hljs-string">&quot;obj&quot;</span>
<span class="hljs-keyword">local</span> csv = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;files&quot;</span>).csv 
<span class="hljs-keyword">local</span> lst = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;list&quot;</span>)
<span class="hljs-keyword">local</span> sfmt = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;strings&quot;</span>).sfmt
<span class="hljs-keyword">local</span> isKlass, isY, isX, isNum, isSym, isSkip, isWhat</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-2">&#x00a7;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-3">&#x00a7;</a>
              </div>
              <h2 id="headers">Headers</h2>
<p>The first row of data names the columns.<br>Those names
contain certain magic symbols.    </p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isSkip</span><span class="hljs-params">(s)</span></span>  <span class="hljs-keyword">return</span> s:<span class="hljs-built_in">find</span>(<span class="hljs-string">&quot;?&quot;</span>) <span class="hljs-keyword">end</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isKlass</span><span class="hljs-params">(s)</span></span> <span class="hljs-keyword">return</span> s:<span class="hljs-built_in">find</span>(<span class="hljs-string">&quot;!&quot;</span>) <span class="hljs-keyword">end</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isNum</span><span class="hljs-params">(s)</span></span>   <span class="hljs-keyword">return</span> s:<span class="hljs-built_in">sub</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>):<span class="hljs-built_in">match</span>(<span class="hljs-string">&quot;[A-Z]&quot;</span>) <span class="hljs-keyword">end</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isY</span><span class="hljs-params">(s)</span></span>     <span class="hljs-keyword">return</span> s:<span class="hljs-built_in">find</span>(<span class="hljs-string">&quot;+&quot;</span>) <span class="hljs-keyword">or</span> s:<span class="hljs-built_in">find</span>(<span class="hljs-string">&quot;-&quot;</span>) <span class="hljs-keyword">or</span> isKlass(s) <span class="hljs-keyword">end</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isWhat</span><span class="hljs-params">(s)</span></span>  
  <span class="hljs-keyword">return</span> isSkip(s) <span class="hljs-keyword">and</span> Skip <span class="hljs-keyword">or</span> (isNum(s) <span class="hljs-keyword">and</span> Num <span class="hljs-keyword">or</span> Sym) <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-4">&#x00a7;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-5">&#x00a7;</a>
              </div>
              <h2 id="create">Create</h2>
<p><strong>new(?init : table = {}) : Sample</strong><br>Create mew table.
If <code>inits</code> supplied, add that data to <code>new</code>.
In this use case, <code>inits</code> <strong>must</strong> contain column  headers at item #1.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Sample:new</span><span class="hljs-params">(inits,       new)</span></span>
  new = obj(<span class="hljs-built_in">self</span>,<span class="hljs-string">&quot;Sample&quot;</span>,
            {rows={},keep=<span class="hljs-literal">true</span>,cols={},names={},x={},y={}})
  <span class="hljs-keyword">for</span> _,row <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(inits <span class="hljs-keyword">or</span> {}) <span class="hljs-keyword">do</span> new:add(row) <span class="hljs-keyword">end</span>  
  <span class="hljs-keyword">return</span> new <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-6">&#x00a7;</a>
              </div>
              <p><strong>clone(?inits : table={}) : Sample</strong><br>Return a table with the same  structure as <code>self</code>.
If <code>inits</code> supplied, add that data to <code>new</code>.
In this use case, <code>inits</code> should <strong>not</strong> contain a class header.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span>  <span class="hljs-title">Sample:clone</span><span class="hljs-params">(inits,    new)</span></span>
  new = Sample:new({<span class="hljs-built_in">self</span>.names})
  <span class="hljs-keyword">for</span> _,row <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(inits <span class="hljs-keyword">or</span> {}) <span class="hljs-keyword">do</span> new:add(row) <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">return</span> new <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-7">&#x00a7;</a>
              </div>
              <p><strong>from(file : str) : self</strong><br>Load rows from file into `self.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Sample:from</span><span class="hljs-params">(file)</span></span> 
  <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> csv(file) <span class="hljs-keyword">do</span> <span class="hljs-built_in">self</span>:add(row) <span class="hljs-keyword">end</span> 
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">self</span> <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-8">&#x00a7;</a>
              </div>
              <p><strong>header(t : table)</strong><br>Read the magic symbols, make the appropriate columns,
store them in the right  places.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Sample:header</span><span class="hljs-params">(t,   what,new,tmp)</span></span>
  <span class="hljs-built_in">self</span>.names = t
  <span class="hljs-keyword">for</span> at,name <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(t)  <span class="hljs-keyword">do</span>
    what = isWhat(name)
    new  = what:new(at,name) 
    <span class="hljs-built_in">self</span>.cols[<span class="hljs-number">1</span>+#<span class="hljs-built_in">self</span>.cols] = new
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> isSkip(name) <span class="hljs-keyword">then</span>
      tmp= <span class="hljs-built_in">self</span>[isY(name) <span class="hljs-keyword">and</span>  <span class="hljs-string">&quot;y&quot;</span> <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;x&quot;</span>]
      tmp[ <span class="hljs-number">1</span>+#tmp ] = new
      <span class="hljs-keyword">if</span> isKlass(name) <span class="hljs-keyword">then</span> <span class="hljs-built_in">self</span>.klass = new <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-9">&#x00a7;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-10">&#x00a7;</a>
              </div>
              <h2 id="update">Update</h2>
<p><strong>add(t : table)</strong><br>If this is the first <code>row</code>, create the header. Else, add new data.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Sample:add</span><span class="hljs-params">(t)</span></span>
   <span class="hljs-keyword">if</span> #<span class="hljs-built_in">self</span>.names &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">then</span> <span class="hljs-built_in">self</span>:data(t) <span class="hljs-keyword">else</span> <span class="hljs-built_in">self</span>:header(t) <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-11">&#x00a7;</a>
              </div>
              <p><strong>data(t : table)</strong><br>Update the column summaries. Maybe  keep the new row.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Sample:data</span><span class="hljs-params">(t,    row)</span></span>
  <span class="hljs-keyword">for</span> _,col <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(<span class="hljs-built_in">self</span>.cols) <span class="hljs-keyword">do</span> <span class="hljs-comment">-- update column summaries</span>
    col:add( t[col.at] ) <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">if</span> <span class="hljs-built_in">self</span>.keep <span class="hljs-keyword">then</span>  <span class="hljs-comment">-- update rows</span>
    <span class="hljs-built_in">self</span>.rows[ <span class="hljs-number">1</span> + #<span class="hljs-built_in">self</span>.rows ] = t <span class="hljs-keyword">end</span> 
  <span class="hljs-keyword">return</span> row <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-12">&#x00a7;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-13">&#x00a7;</a>
              </div>
              <h2 id="query">Query</h2>
<p><strong>better(row1 :table, row2 :table) :boolean</strong><br>Zitler’s <a href="https://doi.org/10.1007/978-3-540-30217-9_84">continuous domination
indicator</a>.  To check
if <code>row1</code> is better than <code>row2</code>, this function runs two “whatif” queries  (that
jump from one individual to another or back again).  According to
Zitler, the thing we like best is the thing that, on average,
losses least across those whatifs.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Sample:better</span><span class="hljs-params">(row1,row2,   e,w,s1,s2,n,a,b,s1,s2)</span></span>
  what1, what2, n, e = <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, #<span class="hljs-built_in">self</span>.y, <span class="hljs-built_in">math</span>.<span class="hljs-built_in">exp</span>(<span class="hljs-number">1</span>)
  <span class="hljs-keyword">for</span> _,col <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(<span class="hljs-built_in">self</span>.y) <span class="hljs-keyword">do</span>
    a    = col:norm(row1[col.at])
    b    = col:norm(row2[col.at])
    w    = col.w <span class="hljs-comment">-- w = (1,-1) if (maximizing,minimizing)</span>
    what1= what1 - e^(col.w * (a - b) / n)
    what2= what2 - e^(col.w * (b - a) / n) <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">return</span> what1 / n &lt; what2 / n <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-14">&#x00a7;</a>
              </div>
              <p> <strong>mid()</strong><br>Report central tendany of all columns.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Sample:mid</span><span class="hljs-params">()</span></span>
  <span class="hljs-keyword">return</span> lst.map(<span class="hljs-built_in">self</span>.cols,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(z)</span></span> <span class="hljs-keyword">return</span> z:mid() <span class="hljs-keyword">end</span>) <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-15">&#x00a7;</a>
              </div>
              <p><strong>ys(fmt)</strong><br>Report central tendany of goals.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Sample:ys</span><span class="hljs-params">(fmt)</span></span>
  fmt = fmt <span class="hljs-keyword">or</span> <span class="hljs-string">&quot; %5.2f&quot;</span>
  <span class="hljs-keyword">return</span> lst.map(<span class="hljs-built_in">self</span>.y,
           <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(z)</span></span> <span class="hljs-keyword">return</span> sfmt(fmt, z:mid()) <span class="hljs-keyword">end</span>) <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-16">&#x00a7;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-17">&#x00a7;</a>
              </div>
              <h2 id="distance">Distance</h2>
<p><strong>dist(row1 : table, row2 : table, the : config) : num</strong><br>Apply Aha’s instance-based distance algorithm,
<a href="https://link.springer.com/content/pdf/10.1007/BF00153759.pdf">section 2.4</a>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Sample:dist</span><span class="hljs-params">(row1,row2,the,       a,b,d,n)</span></span>
  d,n = <span class="hljs-number">0</span>,<span class="hljs-number">1E-32</span>
  <span class="hljs-keyword">for</span> _,col <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(<span class="hljs-built_in">self</span>[the.cols]) <span class="hljs-keyword">do</span>
    n   = n + <span class="hljs-number">1</span>
    a,b = row1[col.at], row2[col.at]
    <span class="hljs-keyword">if</span>    a==<span class="hljs-string">&quot;?&quot;</span> <span class="hljs-keyword">and</span> b==<span class="hljs-string">&quot;?&quot;</span> 
    <span class="hljs-keyword">then</span>  d = d + <span class="hljs-number">1</span>
    <span class="hljs-keyword">else</span>  d = d + col:dist(a,b)^the.p <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">return</span> (d/n)^(<span class="hljs-number">1</span>/the.p) <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-18">&#x00a7;</a>
              </div>
              <p><strong>div(rows : table, the : options) : table,table</strong><br>Split rows via their distance to two faraway points, </p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Sample:div</span><span class="hljs-params">(rows,the,         one,two,three,c,a,b,l,r)</span></span>
  one = lst.any(rows)
  two = <span class="hljs-built_in">self</span>:faraway(one, the, rows)
  three = <span class="hljs-built_in">self</span>:faraway(two, the, rows)
  c   = <span class="hljs-built_in">self</span>:dist(two, three, the)
  tmp = {}
  <span class="hljs-keyword">for</span> _,row <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(rows) <span class="hljs-keyword">do</span>
    a = <span class="hljs-built_in">self</span>:dist(row, two, the)
    b = <span class="hljs-built_in">self</span>:dist(row, three, the)
    tmp[<span class="hljs-number">1</span>+#tmp] = {row= row, 
                   x  = (a^<span class="hljs-number">2</span> + c^<span class="hljs-number">2</span> - b^<span class="hljs-number">2</span>) / (<span class="hljs-number">2</span>*c)} 
  <span class="hljs-keyword">end</span>
  l,r = {},{}
  <span class="hljs-keyword">for</span> i,rowx <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(lst.keysort(tmp,<span class="hljs-string">&quot;x&quot;</span>)) <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">table</span>.<span class="hljs-built_in">insert</span>( i&lt;=#rows//<span class="hljs-number">2</span> <span class="hljs-keyword">and</span> l <span class="hljs-keyword">or</span> r, rowx.row) <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">return</span> l,r <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-19">&#x00a7;</a>
              </div>
              <p><strong>divs(the : options) : [table]</strong><br>Recursive divide rows down to size #rows^(the.enough=.5).<br>Return  one table per leaf.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Sample:divs</span><span class="hljs-params">(the,     out,enough,run,better)</span></span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">run</span><span class="hljs-params">(rows,lvl,      pre,l,r)</span></span>
    <span class="hljs-keyword">if</span> the.loud <span class="hljs-keyword">then</span>  <span class="hljs-comment">-- very useful debugging aid </span>
      pre = <span class="hljs-string">&quot;|.. &quot;</span>;<span class="hljs-built_in">print</span>(pre:<span class="hljs-built_in">rep</span>(lvl)..<span class="hljs-built_in">tostring</span>(#rows))
    <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">if</span> #rows &lt; enough <span class="hljs-keyword">then</span>
      out[#out+<span class="hljs-number">1</span>] = <span class="hljs-built_in">self</span>:clone(rows)
    <span class="hljs-keyword">else</span> 
      l,r = <span class="hljs-built_in">self</span>:div(rows, the,cols)
      run(l, lvl+<span class="hljs-number">1</span>)
      run(r, lvl+<span class="hljs-number">1</span>)  <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span> <span class="hljs-comment">--------------------------------</span>
  out = {}
  enough = <span class="hljs-number">2</span>*(#<span class="hljs-built_in">self</span>.rows)^the.enough
  run(<span class="hljs-built_in">self</span>.rows, <span class="hljs-number">0</span>)
  better = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(t1,t2)</span></span> <span class="hljs-keyword">return</span> <span class="hljs-built_in">self</span>:better(t1:mid(), t2:mid()) <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">return</span> lst.<span class="hljs-built_in">sort</span>(out, better) <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-20">&#x00a7;</a>
              </div>
              <p><strong>faraway(row : table, the : config, rows : table) : table</strong><br>Return  a row that is the.far-.9 distant from 
row across a sample of the.samples=256 rows</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Sample:faraway</span><span class="hljs-params">(row,the,rows,      out,all)</span></span>
  all = <span class="hljs-built_in">self</span>:neighbors(row,the, 
              lst.shuffle(rows, the.samples)) 
  <span class="hljs-keyword">return</span> all[the.far*#all // <span class="hljs-number">1</span>].row <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-21">&#x00a7;</a>
              </div>
              <p> <strong>knn(row : table, the : config)</strong><br>Return some conclusion  from the neighbors of <code>row</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Sample:knn</span><span class="hljs-params">(row,the,     stats,kadd,all,one)</span></span>
  stats = Sym:new()
  all= <span class="hljs-built_in">self</span>:neighbors(row, the, <span class="hljs-built_in">self</span>.rows)
  <span class="hljs-keyword">for</span> i = <span class="hljs-number">2</span>,the.knn <span class="hljs-keyword">do</span> 
    one = all[i].row
    stats:add( one[<span class="hljs-built_in">self</span>.klass.at] ) <span class="hljs-keyword">end</span>
  kadd={mode=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span> <span class="hljs-keyword">return</span> stats.mode <span class="hljs-keyword">end</span>}
  <span class="hljs-keyword">return</span> kadd[the.kadd]() <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-22">&#x00a7;</a>
              </div>
              <p><strong>neighbors(row1 : table, the : options) : num</strong>    </p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Sample:neighbors</span><span class="hljs-params">(row1,the,rows,    t)</span></span>
  t={}
  <span class="hljs-keyword">for</span> _,row2 <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(rows <span class="hljs-keyword">or</span> <span class="hljs-built_in">self</span>.rows) <span class="hljs-keyword">do</span>
     t[<span class="hljs-number">1</span>+#t]= {row=row2, dist=<span class="hljs-built_in">self</span>:dist(row1,row2,the)} <span class="hljs-keyword">end</span> 
  <span class="hljs-keyword">return</span> lst.keysort(t,<span class="hljs-string">&quot;dist&quot;</span>) <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-23">&#x00a7;</a>
              </div>
              <hr>
<h2 id="returns">Returns</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>

<span class="hljs-keyword">return</span> Sample</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
